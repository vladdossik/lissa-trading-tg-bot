# Lissa Trading Telegram Bot Service

**Telegram Bot Service** — это сервис для управления взаимодействием между пользователями и платформой Lissa Trading
через Telegram. Этот бот поддерживает регистрацию, обработку команд и интеграцию с другими микросервисами, такими как
сервис аутентификации и токенизации Tinkoff.

## Основные функции

1. **Обработка пользовательских команд**:
    - `/start` — Начало взаимодействия с ботом и запрос токена.
    - `/token` — Запрос нового токена Tinkoff.
    - `/info` — Вывод информации о пользователе.

2. **Регистрация пользователей**:
    - Регистрация нового пользователя через получение и валидацию токена Tinkoff и пароля.
    - Шифрование токенов и паролей перед передачей в другие сервисы.

3. **Аутентификация**:
    - Получение токенов Tinkoff у зарегистрированных пользователей и обновление этих токенов при необходимости.

4. **Валидация токенов и паролей**:
    - Проверка корректности введённого Tinkoff токена.
    - Валидация пароля с минимальной длиной (3 символа).

5. **Интеграция с другими сервисами**:
    - Сервис аутентификации и регистрации пользователей.
    - Шифрование данных при помощи **EncryptionService** для защиты данных пользователей.

### Архитектура:

#### Основной класс:

- **TelegramBot**: основной класс, который отвечает за логику обработки команд и сообщений от пользователей. Наследуется
  от `TelegramLongPollingBot`.

#### Компоненты:

- **BotCommand**: перечисление команд, поддерживаемых ботом, таких как `/start`, `/token`, `/info`.
- **UserState**: определяет текущее состояние пользователя в диалоге с ботом, например, ожидание токена, пароля или
  нового токена.
- **UserService**: сервис для взаимодействия с базой данных пользователей.
- **EncryptionService**: сервис для шифрования и дешифрования токенов и паролей.

#### Конфигурация:

- **BotConfig**: содержит конфигурационные данные для бота, такие как его имя и токен для доступа к Telegram API.
- **CacheConfig**: настраивает кэш для хранения временных данных пользователей, таких как их текущие состояния.

### Работа с пользователями:

- Бот использует **UserService** для поиска пользователей в базе данных по их Telegram никнейму и для обновления токенов
  Tinkoff.
- Для регистрации пользователей запрашиваются токен Tinkoff и пароль. Эти данные шифруются и сохраняются в системе.

### Состояния пользователя:

1. **TOKEN** — Ожидание ввода Tinkoff токена от пользователя.
2. **PASSWORD** — Ожидание ввода пароля после успешного ввода токена.
3. **WAITING_FOR_NEW_TOKEN** — Ожидание нового токена Tinkoff для обновления.

---

## Kubernetes Deployment

Для развёртывания сервиса в Kubernetes предусмотрены следующие конфигурационные файлы:
`deployment.yaml`, `service.yaml`.